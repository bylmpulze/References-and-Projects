name: Build & Single Release (Windows)

on:
  push:
    branches:
      - "**"
  pull_request:

jobs:
  build-win:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: "3.12"
      - run: |
          python -m pip install --upgrade pip
          pip install pygame pyinstaller
      - run: pyinstaller "Snake Multiplayer/snake.py" --name Snake --onefile --noconsole --add-data "Snake Multiplayer/game/assets;Snake Multiplayer/game/assets" --hidden-import pygame
        shell: pwsh
      - uses: actions/upload-artifact@v4
        with:
          name: Snake-Windows
          path: dist/Snake.exe

  release:
    needs: build-win
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - uses: actions/download-artifact@v4
        with:
          name: Snake-Windows
          path: build
      - run: |
          cp build/Snake.exe .
          zip -j Snake-Windows.zip build/Snake.exe
      - uses: ncipollo/release-action@v1
        with:
          tag: latest   
          name: main          
          allowUpdates: true  # bestehendes Release aktualisieren
          replacesArtifacts: true  # vorhandene Assets ersetzen
          # removeArtifacts: true   # optional: alte Assets vorher l√∂schen
          generateReleaseNotes: true
          artifacts: "Snake.exe, Snake-Windows.zip"
